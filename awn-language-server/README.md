# What is a Language Server?

This project is a "language server", a program which creates an IDE environment based on a language (in this case, AWN), using Microsoft's Language Server Protocol (LSP), an abstract protocol that describes using a programming language in an IDE. For example, the protocol specifies syntax highlighting, autocompletion, and so on. The idea is that, because LSP is abstract, it can be implemented into any IDE, regardless of the language used in the backend of that IDE.

Obviously, no language server already exists for AWN, so this project is a language server for AWN. 
VSCode (and Theia) both understand LSP - they allow LSP language servers to be extensions, which is what is done here.

The language server consists of two parts (which are each their own node.js packages): 
- The client, which interacts with the user directly, and is very light. It sends requests off to the server when the user requires information.
- The server, which is independent of the user, but is interacted with through the client. The server does all the calculations, such as building an AST, and so on.

The language server as a whole is also a node.js package.

# How syntax highlighting and semantic checking works, at a very high level

This section explains the steps for how the "server" part of the language server works for syntax highlighting.

In preparation, a grammar for AWN is defined in ```awn-grammar.peg```, which is then used to create ```parser.js``` automatically and from that ```parser.ts```. This file also contains an (abstract) AST, but this AST is insufficient for the final product*, and is referred to as the "proto-AST". The final-form AST is (abstractly) defined in ```ast.ts```.

When the user edits the .awn file, the following steps are processed:

1. .awn file is converted into a proto-AST by ```parser.ts```.
2. ```convertAST.ts``` converts the proto-AST into the final-form AST.
3. ```check.ts``` checks the AST for semantic errors.

If there is a syntax or semantic error, an error message is sent to the terminal. Otherwise, a list of semantic highlighting tokens are sent to the client (the work of ```semanticTokens.ts```), which syntax highlights the documents.

*Insufficient due to a few reasons - it has unnecessary info, arrays are represented as a chain of parent-child, as are lists of binary operators, which makes the precedence info very annoying to decode.

## Project Structure

```
.
├── client // Language Client
│   ├── src
│   │   ├── test // End to End tests for Language Client / Server
│   │   └── extension.ts // Language Client entry point
├── server // Language Server
│   └── src
│       ├── ast.ts // Abstract Syntax Tree for AWN
│       ├── awn-grammar-noLR.peg // AWN grammar with left-recursion removed - kept for reference
│       ├── awn-grammar-original.peg // "original" AWN grammar - kept for reference, the most readable version
│       ├── awn-grammar.peg // AWN grammar with left-recursion removed AND necessary code inserts - this is the one actually used
│       ├── check.ts // semantic checking of a generated AST
│       ├── convertAST.ts // converts the proto-AST generated by parser.ts into the final AST defined in ast.ts
│       ├── parser.js // PEG grammar parser (original)
│       ├── parser.ts // PEG grammar parser (autoconverted to .ts for compatibility) - uses awn-grammar.peg to convert a .awn file into an AST (referred to as the proto-AST)
│       ├── semanticTokens.ts // returns semantic highlight information to the client when it is requested
│       ├── server.ts // Language Server entry point
│       └── syntaxError.ts // Generates nicer-looking syntax errors
└── tests // Contains test .awn files
```

## Running the Language Server

- Install [VSCode.](https://code.visualstudio.com/download)
- Open this folder in VSCode.
- Install node.js and npm, which come together. You can check if you have them already by running `node -v` and `npm -v`.
	- On Windows, install [here.](https://nodejs.org/en)
	- On Mac, if you have Homebrew, run `brew install node`
	- On Linux, run `sudo apt install nodejs npm`
- Run `npm install` in this folder. This installs all necessary npm modules in both the client and server folder.
- Press ▷ to run the launch config (F5), creating a new instance of VSCode that runs this extension.
- In this new instance of VSCode, open a .awn file inside `\tests`, for example.
- If the language server crashes quickly a few times, it will need to be restarted with Ctrl+R.
